<!DOCTYPE html>
<html><body>
<title>SHADOWS 2</title>
<script type="text/javascript" src = "../common/webgl-utils.js"></script>
<script type="text/javascript" src = "../common/initShaders.js"></script>
<script type="text/javascript" src = "../common/MV.js"></script>
<script type="text/javascript" src = "../common/OBJParser.js"></script>
<script type="text/javascript" src = "w9p3.js"></script>

<script id="vertex-shader-ground" type="x-shader/x-vertex">
    attribute vec3 vPosition;
    attribute vec2 vTexCoord;  

    varying vec2 fTexCoords;
    varying vec4 pl;

    uniform mat4 Pl;  //light P matrix
    uniform mat4 Vl;    //light V matrix

    uniform mat4 V; //view matrix
    uniform mat4 P; //projection matrix   // 45degrees
    uniform mat4 M;
    
    void main() {
        fTexCoords   = vTexCoord;
        pl = Pl*Vl * vec4(vPosition, 1.0);
        gl_Position = P*V*M*vec4(vPosition, 1.0);
    }
</script>

<script id="fragment-shader-ground" type="x-shader/x-fragment">
    precision mediump float;

    varying vec2 fTexCoords;
    varying vec4 pl;
    
    uniform sampler2D groundTex;
    uniform sampler2D shadowMap;
    //uniform texture2D shadowmap;

    void main() {
        vec4 fShadowCoords = 0.5 * (pl/pl.w) + 0.5;
        vec4 rgbaDepth = texture2D(shadowMap, fShadowCoords.xy);
        float depth = rgbaDepth.r;
        if(fShadowCoords.z > depth + 0.003) {
            //shadow
            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
            gl_FragColor = texture2D(groundTex, fTexCoords);
        }
    }
</script>

<script id="vertex-shader-teapot" type="x-shader/x-vertex">
    attribute vec3 vPosition; 
    attribute vec3 vNormal;
    attribute vec4 vColor;

    varying vec4 a_color;
    
    uniform mat4 V; //view matrix
    uniform mat4 P; //projection matrix   // 45degrees
    uniform mat4 M; //model matrix

       void main(){
            gl_Position = (P*V*M) * vec4(vPosition, 1.0);
            a_color     = vec4(vNormal.y*vColor.rgb, vColor.a);
       }
</script>

<script id="fragment-shader-teapot" type="x-shader/x-fragment">
    precision mediump float;
    varying vec4 a_color;

    uniform bool isShadow;

    void main() {
        if(isShadow){
            gl_FragColor = vec4(0,0,0,1.0);
        } else {
            gl_FragColor = a_color;
        }
    }
</script>

<script id="vertex-shader-fbo" type="x-shader/x-vertex">
    attribute vec3 vPosition; 
    
    uniform mat4 V; //view matrix
    uniform mat4 P; //projection matrix   // 45degrees
    uniform mat4 M; //model matrix

       void main(){
            gl_Position = (P*V*M) * vec4(vPosition, 1.0);
       }
</script>

<script id="fragment-shader-fbo" type="x-shader/x-fragment">
    precision mediump float;

    void main() {
        gl_FragColor = vec4(gl_FragCoord.z, 0.0, 0.0, 1.0);
    }
</script>


</head>
<body>
    <canvas id="canvas" width="512" height="512"> The browser does not support the HTML5 canvas element. </canvas>
    <button id="toggleLightButton">Toggle Light Movement</button>
    <button id="toggleTeapotMovement"> Toggle Teapot Movement</button>
</body>
</html>




